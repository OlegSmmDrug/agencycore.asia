# Инструкция: Удаление пользователей

## Проблема с удалением пользователей

В системе в настоящее время **отсутствует функционал удаления пользователей** через интерфейс.

### Причины, почему не удаляются пользователи:

1. **Нет UI кнопки удаления** - в интерфейсе управления командой нет кнопки для удаления пользователя
2. **Метод delete() не реализован** в `userService.ts`
3. **Связанные данные** - у некоторых пользователей есть связанные записи в других таблицах (payroll_records, tasks и т.д.) с правилом `ON DELETE NO ACTION`

### Почему не удаляются конкретные пользователи:

- **davinablago@gmail.com**
- **director@agency.kz**
- **sales@agency.com**
- **smm@agency.com**

Эти пользователи, вероятно, имеют связанные данные в системе (задачи, выплаты зарплат, проекты и т.д.), которые блокируют удаление.

## Варианты решения

### Вариант 1: Деактивация пользователей (Рекомендуется)

Вместо удаления лучше использовать деактивацию - пользователь помечается как неактивный, но данные сохраняются.

**Преимущества:**
- Сохраняется история (кто делал задачи, кто получал зарплату)
- Можно восстановить в любой момент
- Не ломает связанные данные

**Как реализовать:**
1. Добавить поле `is_active` в таблицу `users`
2. При деактивации устанавливать `is_active = false`
3. Фильтровать неактивных пользователей в списках

### Вариант 2: Каскадное удаление

Если действительно нужно удалять пользователей:

1. Изменить внешние ключи на `ON DELETE CASCADE` или `ON DELETE SET NULL`
2. Создать транзакцию, которая:
   - Переназначает активные задачи другому пользователю
   - Архивирует записи о зарплатах
   - Удаляет пользователя

### Вариант 3: Мягкое удаление (Soft Delete)

Добавить поле `deleted_at`:
- При "удалении" устанавливается текущая дата
- Пользователь скрывается из интерфейса
- Данные остаются в базе для аудита

## Рекомендуемая реализация

```typescript
// В userService.ts
async deactivate(userId: string): Promise<void> {
  const { error } = await supabase
    .from('users')
    .update({ is_active: false })
    .eq('id', userId);

  if (error) {
    console.error('Error deactivating user:', error);
    throw error;
  }
}

async activate(userId: string): Promise<void> {
  const { error } = await supabase
    .from('users')
    .update({ is_active: true })
    .eq('id', userId);

  if (error) {
    console.error('Error activating user:', error);
    throw error;
  }
}
```

## Важно

**НЕ удаляйте пользователей напрямую из базы данных**, если они имеют связанные данные. Это может привести к:
- Потере важной информации
- Ошибкам в отчетах
- Проблемам с историей выплат зарплат
- Нарушению целостности данных

Используйте деактивацию как безопасную альтернативу удалению.
