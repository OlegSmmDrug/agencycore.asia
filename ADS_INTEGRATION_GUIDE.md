# Руководство по подключению рекламных платформ

Это руководство описывает процесс подключения трех рекламных платформ к проектам: Facebook Ads, Google Ads и TikTok Ads.

## Общие принципы

Каждый проект имеет собственные настройки для каждой рекламной платформы:
- Собственный Access Token
- Собственный ID рекламного аккаунта
- Собственный набор отображаемых метрик

Настройки одного проекта **не влияют** на другие проекты.

---

## Facebook Ads

### Как получить Access Token

1. Перейдите в **Facebook Business Settings** (business.facebook.com)
2. Выберите **System Users** в левом меню или создайте нового пользователя
3. Назначьте созданному System User доступ к нужному рекламному аккаунту
4. Нажмите **Generate New Token**
5. Выберите разрешения: `ads_read` (минимум)
6. Скопируйте сгенерированный токен

### Как найти ID рекламного аккаунта

1. Откройте **Facebook Ads Manager** (business.facebook.com/adsmanager)
2. В левом верхнем углу выберите нужный рекламный аккаунт
3. ID аккаунта отображается в формате `act_123456789` или просто `123456789`
4. Можно использовать любой из форматов

### Где вводить данные

1. Откройте нужный проект
2. Перейдите на вкладку **Реклама Facebook**
3. Введите Access Token
4. Введите ID рекламного аккаунта
5. Нажмите **Подключить аккаунт**

### Доступные метрики

- Расходы (Spend)
- Лиды (Leads)
- Цена за лид (CPL)
- Сообщения (Messages)
- ROAS
- Показы (Impressions)
- Клики (Clicks)
- CTR
- CPM
- Частота (Frequency)

---

## Google Ads

### Как получить Access Token

1. Перейдите в **Google Cloud Console** (console.cloud.google.com)
2. Создайте новый проект или выберите существующий
3. Включите **Google Ads API** в библиотеке API
4. Настройте **OAuth 2.0 Client ID**:
   - Перейдите в "APIs & Services" → "Credentials"
   - Создайте OAuth 2.0 Client ID
   - Выберите тип приложения (Web application)
5. Получите токен доступа через OAuth flow с правами `adwords`
6. Скопируйте полученный Access Token

### Как найти Customer ID

1. Откройте **Google Ads** (ads.google.com)
2. В правом верхнем углу найдите Customer ID
3. Формат: `123-456-7890` (с дефисами)
4. Скопируйте точно как отображается

### Где вводить данные

1. Откройте нужный проект
2. Перейдите на вкладку **Реклама Google**
3. Введите OAuth Access Token
4. Введите Customer ID в формате 123-456-7890
5. Нажмите **Подключить аккаунт**

### Доступные метрики

- Расходы (Cost)
- Конверсии (Conversions)
- Цена за клик (CPC)
- CTR
- Показы (Impressions)
- Клики (Clicks)
- Цена за конверсию (Cost per Conversion)

---

## TikTok Ads

### Как получить Access Token

1. Перейдите в **TikTok For Business Developer Portal** (ads.tiktok.com/marketing_api)
2. Создайте приложение для **Marketing API**
3. Настройте OAuth 2.0:
   - Добавьте Redirect URLs
   - Запросите разрешения: `Reporting` (минимум)
4. Пройдите процесс авторизации OAuth
5. Сохраните полученный Access Token

### Как найти Advertiser ID

1. Откройте **TikTok Ads Manager** (ads.tiktok.com)
2. Перейдите в **Settings** → **Account**
3. Найдите **Advertiser ID** (формат: 16-значное число)
4. Скопируйте ID

### Где вводить данные

1. Откройте нужный проект
2. Перейдите на вкладку **Реклама TikTok**
3. Введите Access Token
4. Введите Advertiser ID
5. Нажмите **Подключить аккаунт**

### Доступные метрики

- Расходы (Spend)
- Конверсии (Conversions)
- Цена за клик (CPC)
- CTR
- Показы (Impressions)
- Клики (Clicks)
- Просмотры видео (Video Views)
- Цена за конверсию (Cost per Conversion)

---

## Настройка метрик

Каждый проект может иметь свой набор отображаемых метрик для каждой платформы:

1. Откройте проект и нужную вкладку рекламы
2. Нажмите кнопку **Настроить метрики**
3. Выберите нужные метрики из списка
4. Настройки сохраняются автоматически для данного проекта

---

## Гостевой доступ

Владелец проекта может предоставить гостевой доступ к аналитике:

1. Откройте проект → нажмите **Поделиться**
2. В разделе **Видимость вкладок** отметьте:
   - **Facebook аналитика** - доступ к данным Facebook Ads
   - **Google Ads аналитика** - доступ к данным Google Ads
   - **TikTok Ads аналитика** - доступ к данным TikTok Ads
3. Скопируйте ссылку и отправьте гостю
4. Гость увидит только данные аналитики в режиме "только чтение"

---

## Устранение проблем

### Токен недействителен

- **Facebook**: Проверьте срок действия токена в Business Settings
- **Google**: Токены OAuth обновляются автоматически через Refresh Token
- **TikTok**: Проверьте разрешения токена в Developer Portal

### Не отображаются данные

1. Убедитесь, что ID аккаунта введен правильно
2. Проверьте, что токен имеет права на чтение данных
3. Убедитесь, что в аккаунте есть активные кампании

### Настройки сбрасываются

Если настройки одного проекта влияют на другой:
1. Обновите страницу
2. Проверьте, что вы находитесь в правильном проекте
3. Настройки теперь привязаны к ID проекта и не могут перемешиваться

---

## Технические детали

### Хранение данных

Все настройки хранятся в таблице `projects`:

**Facebook Ads:**
- `facebook_access_token` - токен доступа
- `ad_account_id` - ID рекламного аккаунта
- `fb_ads_visible_metrics` - массив выбранных метрик

**Google Ads:**
- `google_ads_access_token` - токен доступа
- `google_ads_refresh_token` - токен обновления (для будущего использования)
- `google_ads_customer_id` - Customer ID
- `google_ads_visible_metrics` - массив выбранных метрик

**TikTok Ads:**
- `tiktok_ads_access_token` - токен доступа
- `tiktok_ads_advertiser_id` - Advertiser ID
- `tiktok_ads_visible_metrics` - массив выбранных метрик

### Безопасность

- Токены хранятся в зашифрованном виде в базе данных
- Токены не передаются на клиент в явном виде
- Каждый проект изолирован от других проектов

---

## Поддержка

При возникновении проблем с подключением:

1. Проверьте правильность введенных данных
2. Убедитесь в наличии необходимых разрешений
3. Проверьте срок действия токенов
4. Обратитесь к документации соответствующей платформы
