# Инструкция по настройке супер-администратора

## Что было создано

1. **Миграция базы данных** - добавлено поле `is_super_admin` в таблицу `users`
2. **Компонент SuperAdminDashboard** - интерфейс супер-админа с:
   - Обзором платформы (MRR, активные пользователи, отток, здоровье серверов)
   - Управлением компаниями (tenants)
   - Поиском по организациям
3. **Функции базы данных**:
   - `get_platform_statistics()` - возвращает общую статистику платформы
   - `get_organizations_list()` - возвращает список всех организаций

## Как получить доступ к панели супер-админа

### Шаг 1: Назначить себя супер-администратором

Выполните следующий SQL-запрос в Supabase SQL Editor, заменив `your-email@example.com` на ваш email:

```sql
UPDATE users
SET is_super_admin = true
WHERE email = 'your-email@example.com';
```

### Шаг 2: Выйти и войти заново

1. Выйдите из системы
2. Войдите снова с вашим email и паролем
3. Вы автоматически попадете в интерфейс супер-админа

## Функции супер-админ панели

### Обзор (Overview)
- **Общий MRR** - месячный регулярный доход со всех организаций
- **Активные пользователи** - количество пользователей в активных организациях
- **Отток (Churn)** - процент организаций, отменивших подписку за последний месяц
- **Здоровье серверов** - статус работы системы

### Компании (Tenants)
Список всех зарегистрированных организаций с информацией:
- Название компании
- Email владельца
- Тарифный план
- Статус подписки
- Месячный доход (MRR)
- Дата регистрации

## Безопасность

- Только пользователи с `is_super_admin = true` могут вызывать функции супер-админа
- Функции защищены на уровне базы данных через `SECURITY DEFINER`
- При попытке доступа без прав возникает ошибка "Access denied: super admin only"

## Примечание

Интерфейс супер-админа полностью отделен от обычного интерфейса ERP. Когда вы входите как супер-админ, вы видите только панель управления платформой, без доступа к данным конкретных организаций (это сделано для разделения ответственности).

Если вам нужно работать с конкретной организацией, войдите под обычным аккаунтом пользователя этой организации.
